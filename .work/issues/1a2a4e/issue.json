{
  "id": "1a2a4e",
  "title": "Explore: .work/issues directory bloat prevention",
  "status": "active",
  "type": "feature",
  "priority": 2,
  "labels": [
    "explore"
  ],
  "created": "2026-02-15T21:13:39.859133Z",
  "updated": "2026-02-15T21:21:31.624458Z",
  "description": "# .work/issues Directory Bloat Prevention (Revised)\n\n## Current State\n\n23 issues, 188 KB on disk (32.5 KB actual JSON, rest is 4 KB\nblock overhead per file). Size distribution is heavily skewed:\n\n| Category        | Count | Avg Desc | % of Data |\n|-----------------|-------|----------|-----------|\n| Explore issues  | 4     | 2,983 B  | 62%       |\n| Phase issues    | 18    | 345 B    | 33%       |\n| Other           | 1     | 933 B    | 5%        |\n\nThe 4 explore issues account for 62% of all description data\ndespite being 17% of issue count. Descriptions are 75% of\ntotal data.\n\n### Do We Need Old Issue Data?\n\n| Field          | Need After Done? | Rationale                |\n|----------------|------------------|--------------------------|\n| id, title      | Yes              | Audit trail              |\n| status, type   | Yes              | Filtering/reporting      |\n| labels, dates  | Yes              | Timeline, velocity       |\n| parent_id      | Yes              | Issue lineage            |\n| **description**| **No**           | Transfers via /prepare   |\n| **comments**   | **No**           | Linkage in parent_id     |\n| **history**    | **Mostly no**    | Only create+close matter |\n\nExplore descriptions become child issues via /prepare — the\nknowledge transfers forward. Nobody re-reads a completed\nanalysis.\n\n### Growth: Raw vs Compacted (~460 B/closed issue)\n\n| Usage (issues/wk) | 1 year raw | 1 year compact | Savings |\n|--------------------|------------|----------------|---------|\n| 5 (light)          | 382 KB     | 126 KB         | 67%     |\n| 15 (medium)        | 1 MB       | 360 KB         | 65%     |\n| 25 (heavy)         | 1.6 MB     | 594 KB         | 63%     |\n\nReal costs aren't disk but: ListIssues() O(n) scan, git object\naccumulation, block overhead (5K files = ~20 MB blocks for\n~3 MB data), cognitive noise.\n\n## Recommendation: Compact-on-Close + Completion Log\n\n**Previous rec (archive to separate dir) addressed wrong\nproblem.** Moving files doesn't reduce data, adds search\ncomplexity, and still accumulates in git.\n\n### Compact-on-Close\n\nOn transition to done/cancelled:\n1. Strip description to first line only (max 120 chars)\n2. Clear comments array\n3. Compact history.jsonl to create + final close events only\n4. Keep all metadata fields intact\n\nResult: ~460 bytes per closed issue vs 500-5000 bytes.\n\n### Completion Log\n\nAppend one-line JSON to `.work/log.jsonl` per completed issue:\n```json\n{\"id\":\"abd7c9\",\"title\":\"Explore: personas\",\"status\":\"done\",\n \"labels\":[\"explore\"],\"created\":\"...\",\"closed\":\"...\"}\n```\n~150 bytes/entry. 2 years heavy use = 390 KB single file.\nEnables fast grep-based history without scanning directories.\n\n### Why This Beats Archiving\n\n- Simpler: no second directory to search\n- Less git churn: no file moves (git sees as delete+create)\n- Full content recoverable: `git show HEAD~N:path/issue.json`\n- Directly solves \"chonky markdown\" problem\n\n## Implementation Phases\n\n**Phase 1: Compact-on-close core**\n1. Add `CompactIssue(id)` — truncate desc, clear comments,\n   compact history\n2. Call automatically on done/cancelled transitions\n3. Add `--no-compact` flag for opt-out\n4. Add `work compact \u003cid\u003e` for manual use\n5. Add `work compact --all-done` for bulk retroactive\n\n**Phase 2: Completion log**\n6. Append to `.work/log.jsonl` during compact\n7. Add `work log` command for completion history\n8. Add `--since`, `--label`, `--type` filters\n\n**Phase 3: Eliminate comment duplication**\n9. Remove `text` from history.jsonl comment events\n10. Keep just op, ts, by — comments live in issue.json only\n11. Apply to new events only (no rewrite)\n\n**Phase 4: Directory purge (long-lived projects)**\n12. `work gc` — delete dirs for done issues older than N days\n13. Requires log.jsonl (Phase 2) so metadata survives\n14. `work show \u003cpurged-id\u003e` returns \"purged, see work log\"\n\n**Phase 5: ListIssues index (only if \u003e500 issues)**\n15. `.work/index.json` with lightweight metadata\n16. `ListIssues()` reads index instead of scanning dirs\n17. `work reindex` to rebuild"
}